@let vm = vm$ | async; @if (vm && vm.quiz) {
<div class="p-4 flex flex-col">
    @if (vm.quiz.id === undefined) {
        <h1 class="text-xl font-bold">Create New Quiz</h1>
    } @else {
        <h1 class="text-xl font-bold">{{ vm.quiz.title }}</h1>
    }

    @if (!vm.quiz.isPublished) {
        <div class="flex flex-col md:flex-row mt-4">
            <button
                type="button"
                class="mt-4 md:mr-4 border border-gray-700 bg-gray-800 text-white p-2 rounded hover:bg-gray-700 md:w-32"
                [disabled]="vm.quiz.isPublished"
                (click)="handleSave()">Save</button>
            <button
                type="button"
                class="mt-4 md:mr-4 border border-gray-700 bg-gray-800 text-white p-2 rounded hover:bg-gray-700 md:w-32"
                [disabled]="vm.quiz.isPublished"
                (click)="handlePublish()">Publish</button>
        </div>
    }

    <form [formGroup]="vm.form" class="mt-4 mb-4">
        <section class="quiz-details">
            <div class="flex flex-col md:flex-row mb-4 md:items-center">
                <label for="title" class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Title</label> 
                <div class="flex flex-col w-full">
                    <input id="title" type="text" formControlName="title" class="border border-gray-300 rounded p-2 w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-gray-800" />
                    @let title = vm.form.get('title');
                    @if (title && title.invalid && (title.dirty || title.touched)) {
                        <div class="alert alert-danger">
                            @if (title.hasError('required')) {
                                <div>Title is required.</div>
                            }

                            @if (title.hasError('not-empty')) {
                                <div>Title must have non-whitespace characters.</div>
                            }
                        </div>
                    }
                </div>
            </div>
            <div class="flex flex-col md:flex-row mb-4 md:items-center">
                <label for="title" class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Description</label>
                <input id="title" type="text" formControlName="description" class="border border-gray-300 rounded p-2 w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-gray-800" />
            </div>
            <div class="flex flex-col md:flex-row mb-4 md:items-center">
                <label for="title" class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Time Limit (seconds)</label>
                <div class="flex flex-col w-full">
                    <input id="title" type="number" formControlName="timeLimit" class="border border-gray-300 rounded p-2 w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-gray-800" min="1" />
                    @let timeLimit = vm.form.get('timeLimit');
                    @if (timeLimit && timeLimit.invalid && (timeLimit.dirty || timeLimit.touched)) {
                        <div class="alert alert-danger">
                            @if (timeLimit.hasError('required')) {
                                <div>Time limit is required.</div>
                            }

                            @if (timeLimit.hasError('min')) {
                                <div>Time Limit must be greater than zero seconds.</div>
                            }
                        </div>
                    }
                </div>
            </div>
            <div class="flex flex-col md:flex-row mb-4 md:items-center">
                <label class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Shuffle Questions</label>
                <div class="flex items-center space-x-4 w-full">
                    <label class="flex items-center">
                        <input type="radio" formControlName="shuffleQuestions" [value]="true" class="border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-800" />
                        <span class="ml-2 text-gray-700">Yes</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" formControlName="shuffleQuestions" [value]="false" class="border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-800" />
                        <span class="ml-2 text-gray-700">No</span>
                    </label>
                </div>
            </div>
        </section>

        <section class="questions" formArrayName="questions">
            <h1 class="text-xl font-bold">Questions</h1>
            
            @if (!vm.quiz.isPublished) {
                <button
                    type="button"
                    class="mt-4 md:mr-4 border border-gray-700 bg-gray-800 text-white p-2 rounded hover:bg-gray-700 md:w-32"
                    (click)="handleAddQuestion()">Add Question</button>
            }

            @for(question of questions.controls; track question; let i = $index) {
                <div [formGroupName]="i" class="mt-4"> 
                    <div class="flex flex-col md:flex-row mb-4 md:items-center">
                        <label for="prompt-{{i}}" class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Question</label>
                        <div class="flex flex-col w-full">
                            <input id="prompt-{{i}}" type="text" formControlName="prompt" class="border border-gray-300 rounded p-2 w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-gray-800" />
                            @let prompt = question.get('prompt');
                            @if (prompt && prompt.invalid && (prompt.dirty || prompt.touched)) {
                                <div class="alert alert-danger">
                                    @if (prompt.hasError('required')) {
                                        <div>Question is required.</div>
                                    }

                                    @if (prompt.hasError('not-empty')) {
                                        <div>Question must have non-whitespace characters.</div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row mb-4 md:items-center">
                        <label class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Required</label>
                        <div class="flex items-center space-x-4 w-full">
                            <label class="flex items-center">
                                <input type="radio" formControlName="required" [value]="true" class="border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-800" />
                                <span class="ml-2 text-gray-700">Yes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" formControlName="required" [value]="false" class="border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-800" />
                                <span class="ml-2 text-gray-700">No</span>
                            </label>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row mb-4 md:items-center">
                        <label for="pointValue-{{i}}" class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Point Value</label>
                        <div class="flex flex-col w-full">
                            <input id="pointValue-{{i}}" type="number" formControlName="pointValue" class="border border-gray-300 rounded p-2 w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-gray-800" min="0" />
                            @let pointValue = question.get('pointValue');
                            @if (pointValue && pointValue.invalid && (pointValue.dirty || pointValue.touched)) {
                                <div class="alert alert-danger">
                                    @if (pointValue.hasError('required')) {
                                        <div>Point Value is required.</div>
                                    }

                                    @if (pointValue.hasError('min')) {
                                        <div>Point Value must be greater than zero.</div>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                    <div formArrayName="answers" class="mt-4 ml-8: md:ml-16">
                        <h2 class="text-lg font-semibold">Answers</h2>

                        @if (!vm.quiz.isPublished) {
                            <button
                                type="button"
                                class="mt-4 md:mr-4 border border-gray-700 bg-gray-800 text-white p-2 rounded hover:bg-gray-700 md:w-32"
                                (click)="handleAddAnswer(question)">Add Answer</button>
                        }
                        @if (question.get('answers') !== null) {
                            @for(answer of answers(question).controls; track answer; let j = $index) {
                                <div [formGroupName]="j" class="mt-2">
                                    <div class="flex flex-col md:flex-row mb-4 md:items-center">
                                        <label for="answerValue-{{i}}-{{j}}" class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Answer</label>
                                        <input id="answerValue-{{i}}-{{j}}" type="text" formControlName="value" class="border border-gray-300 rounded p-2 w-full md:w-auto focus:outline-none focus:ring-2 focus:ring-gray-800" />
                                    </div> 
                                    <div class="flex flex-col md:flex-row mb-4 md:items-center">
                                        <label class="block w-full md:w-64 text-gray-700 font-medium mb-2 md:mb-0 md:mr-4">Is Correct</label>
                                        <div class="flex items-center space-x-4 w-full">
                                            <label class="flex items-center">
                                                <input type="radio" formControlName="isCorrect" [value]="true" class="border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-800" />
                                                <span class="ml-2 text-gray-700">Yes</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" formControlName="isCorrect" [value]="false" class="border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-gray-800" />
                                                <span class="ml-2 text-gray-700">No</span>
                                            </label>
                                        </div>
                                    </div>

                                    @if (!vm.quiz.isPublished) {
                                        <button
                                            type="button"
                                            class="mt-4 md:mr-4 border border-gray-700 bg-gray-800 text-white p-2 rounded hover:bg-gray-700 md:w-32"
                                            (click)="handleDeleteAnswer(question, j)">Delete Answer</button>
                                    }
                                </div>
                            }
                        } 
                    </div>
                </div>
            } 
        </section>
    </form>
</div>
}
