<app-card>
  <div header>
    <app-toolbar>
      <div left>
        <h1 class="text-2xl font-bold mb-4">Tests</h1>
      </div>
      <div right>
        <button (click)="handleNew()">New</button>
      </div>
    </app-toolbar>
  </div> 

  <div class="overflow-x-auto" content>
    <div class="grid grid-cols-1 gap-4 md:table md:w-full md:border-collapse md:border md:border-gray-300">
      <div class="hidden md:table-header-group bg-gray-100">
        <div class="md:table-row">
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Quiz</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Description</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Time Limit</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Time Remaining</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Submitted</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Points</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Score</div>
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-left">Actions</div>
        </div>
      </div>
      @for(test of tests$(); track test.id) {
        <div class="md:table-row hover:bg-gray-50">
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Quiz:</span>
            {{ test.quiz.title || 'Unknown Quiz' }}
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Description:</span>
            {{ test.quiz.description || 'No Description' }}
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Time Limit:</span>
            {{ formatDuration(test.quiz.timeLimit || 0) }}
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Time Remaining:</span>
            {{ test.timeRemaining() }}
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Submitted:</span>
            {{ test.isSubmitted ? 'Yes' : 'No' }}
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Points:</span>
            @if (test.isSubmitted) {
              {{ test.score.points }}
            }
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Score:</span>
            @if (test.isSubmitted) {
              {{ test.score.correct }} / {{ test.questions.length }} : {{ test.score.percent }}%
            }
          </div>
          <div class="grid grid-cols-2 md:table-cell border border-gray-300 px-4 py-2">
            <span class="font-bold md:hidden">Actions:</span>
            <button (click)="handleEdit(test)">{{ test.isSubmitted ? 'View' : 'Resume' }}</button>
          </div>
        </div>
      } @empty {
        <div class="md:table-row">
          <div class="md:table-cell border border-gray-300 px-4 py-2 text-center" colspan="8">There are no tests available.</div>
        </div>
      }
    </div>
  </div>
</app-card>

<app-dialog [isOpen]="isDialogOpen">
  <div header>
    <h2 class="text-xl font-bold">Select a Quiz</h2>
  </div>
  <div content>
    <form [formGroup]="form">
      <label for="quiz-select" class="block text-sm font-medium text-gray-700">Quiz</label>
      <select id="quiz-select" formControlName="selectedQuizId" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
        <option value="" disabled selected>Select a quiz</option>
        @for(quiz of publishedQuizzes$(); track quiz.id) {
          <option [value]="quiz.id">{{ quiz.title }}{{ quiz.description ? ` - ${quiz.description}` : ''}}</option>
        }
      </select>
    </form>
  </div>
  <div footer>
    <app-toolbar>
      <div left>
        <button (click)="handleDialogCancel()">Cancel</button>
      </div>
      <div right>
        <button (click)="handleDialogSave()">Save</button>
      </div>
    </app-toolbar>
  </div>
</app-dialog>
